{% extends 'base.html' %}
{% load static %}

{% block title %}Créer un Post - {{ communaute.nom }} - Forum CODM Tracker{% endblock %}
{% block nav_forum %}active{% endblock %}

{% block extra_css %}
<style>
.create-post-container {
    padding: 60px 0 100px;
}

.create-post-card {
    background: var(--gradient-card);
    border-radius: var(--card-radius);
    padding: 40px;
    border: 2px solid var(--primary-red);
    max-width: 800px;
    margin: 0 auto;
}

.create-post-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--primary-red);
}

.create-post-header-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: white;
}

.create-post-header h1 {
    font-size: 2rem;
    font-family: var(--font-heading);
    color: var(--text-white);
}

.form-group {
    margin-bottom: 25px;
}

.form-label {
    display: block;
    margin-bottom: 10px;
    color: var(--text-white);
    font-weight: 600;
    font-size: 1rem;
}

.form-label .required {
    color: var(--primary-red);
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    background: var(--dark-grey);
    border: 2px solid var(--medium-grey);
    border-radius: var(--border-radius);
    color: var(--text-white);
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.3s ease;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-red);
    box-shadow: 0 0 0 3px rgba(255, 26, 26, 0.1);
}

textarea.form-control {
    min-height: 150px;
    resize: vertical;
}

.type-selector {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 25px;
}

.type-option {
    padding: 15px;
    background: var(--dark-grey);
    border: 2px solid var(--medium-grey);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.type-option input[type="radio"] {
    display: none;
}

.type-option input[type="radio"]:checked + .type-option-content {
    color: var(--primary-red);
}

.type-option:hover {
    border-color: var(--primary-red);
    transform: translateY(-2px);
}

.type-option input[type="radio"]:checked ~ .type-option-content,
.type-option:has(input[type="radio"]:checked) {
    border-color: var(--primary-red);
    background: rgba(255, 26, 26, 0.1);
}

.type-option-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    color: var(--text-white);
}

.type-option-content i {
    font-size: 1.5rem;
}

.type-option-content span {
    font-weight: 600;
    font-size: 0.9rem;
}

.image-preview {
    margin-top: 15px;
    max-width: 100%;
    border-radius: var(--border-radius);
    border: 2px solid var(--medium-grey);
    display: none;
}

.image-preview.show {
    display: block;
}

.form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    justify-content: flex-end;
}

.btn-cancel {
    background: var(--gradient-card);
    border: 1px solid var(--medium-grey);
    color: var(--text-white);
}

.btn-cancel:hover {
    border-color: var(--primary-red);
    color: var(--primary-red);
}
</style>
{% endblock %}

{% block content %}
<section class="create-post-container">
    <div class="container">
        <div class="create-post-card">
            <div class="create-post-header">
                <div class="create-post-header-icon" style="background: {{ communaute.couleur }};">
                    <i class="{{ communaute.icone }}"></i>
                </div>
                <h1>Créer un Post dans <span class="highlight">{{ communaute.nom }}</span></h1>
            </div>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="form-group">
                    <label class="form-label">
                        Type de post <span class="required">*</span>
                    </label>
                    <div class="type-selector">
                        <label class="type-option">
                            <input type="radio" name="type_post" value="texte" checked>
                            <div class="type-option-content">
                                <i class="fas fa-file-alt"></i>
                                <span>Texte</span>
                            </div>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="type_post" value="image">
                            <div class="type-option-content">
                                <i class="fas fa-image"></i>
                                <span>Image</span>
                            </div>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="type_post" value="lien">
                            <div class="type-option-content">
                                <i class="fas fa-link"></i>
                                <span>Lien</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="titre" class="form-label">
                        Titre <span class="required">*</span>
                    </label>
                    <input type="text" id="titre" name="titre" class="form-control" required 
                           placeholder="Donnez un titre à votre post" maxlength="200">
                </div>

                <div class="form-group">
                    <label for="contenu" class="form-label">
                        Contenu <span class="required">*</span>
                    </label>
                    <textarea id="contenu" name="contenu" class="form-control" required 
                              placeholder="Rédigez votre post..."></textarea>
                </div>

                <div class="form-group" id="image-group" style="display: none;">
                    <label for="image" class="form-label">
                        Image
                    </label>
                    <input type="file" id="image" name="image" class="form-control" accept="image/*">
                    <img id="image-preview" class="image-preview" alt="Aperçu">
                </div>

                <div class="form-group" id="lien-group" style="display: none;">
                    <label for="lien_url" class="form-label">
                        URL du lien
                    </label>
                    <input type="url" id="lien_url" name="lien_url" class="form-control" 
                           placeholder="https://example.com">
                </div>

                <div class="form-actions">
                    <a href="{% url 'forum:communaute' communaute.slug %}" class="btn btn-cancel">
                        <i class="fas fa-times"></i> Annuler
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Publier
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const typeSelectors = document.querySelectorAll('input[name="type_post"]');
    const imageGroup = document.getElementById('image-group');
    const lienGroup = document.getElementById('lien-group');
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('image-preview');

    typeSelectors.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.value === 'image') {
                imageGroup.style.display = 'block';
                lienGroup.style.display = 'none';
                document.getElementById('lien_url').value = '';
            } else if (this.value === 'lien') {
                imageGroup.style.display = 'none';
                lienGroup.style.display = 'block';
                imageInput.value = '';
                imagePreview.classList.remove('show');
            } else {
                imageGroup.style.display = 'none';
                lienGroup.style.display = 'none';
                imageInput.value = '';
                document.getElementById('lien_url').value = '';
                imagePreview.classList.remove('show');
            }
        });
    });

    imageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.classList.add('show');
            };
            reader.readAsDataURL(file);
        }
    });
});
</script>
{% endblock %}
