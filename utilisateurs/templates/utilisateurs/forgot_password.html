{% extends 'base.html' %}
{% load static %}

{% block title %}Mot de passe oublié - CODM Tracker{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <div class="auth-logo">
                <div class="logo-icon">CT</div>
                <div class="logo-text">CODM<span>Tracker</span></div>
            </div>
            <h1 class="auth-title">
                {% if step == 'email' %}Mot de passe oublié
                {% elif step == 'otp' %}Vérification
                {% else %}Nouveau mot de passe{% endif %}
            </h1>
            <p class="auth-subtitle">
                {% if step == 'email' %}Entrez votre email pour recevoir un code de réinitialisation
                {% elif step == 'otp' %}Entrez le code reçu par email
                {% else %}Choisissez un nouveau mot de passe{% endif %}
            </p>
        </div>
        
        {% if step == 'email' %}
        <form method="POST" action="{% url 'utilisateurs:forgot_password' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="email">
            
            <div class="form-group">
                <label class="form-label" for="email">Email</label>
                <input type="email" id="email" name="email" class="form-input" placeholder="Entrez votre email" required>
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-paper-plane"></i>
                Envoyer le code
            </button>
        </form>
        
        {% elif step == 'otp' %}
        <form method="POST" action="{% url 'utilisateurs:forgot_password' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="otp">
            
            <div class="form-group">
                <p style="color: var(--text-grey); margin-bottom: 20px;">
                    Code envoyé à <strong>{{ email }}</strong>
                </p>
                <label class="form-label" for="code">Code de vérification</label>
                <input type="text" id="code" name="code" class="form-input" placeholder="Entrez le code à 6 chiffres" required maxlength="6" pattern="[0-9]{6}">
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 15px;">
                <i class="fas fa-check"></i>
                Vérifier le code
            </button>
            
            <form method="POST" action="{% url 'utilisateurs:forgot_password' %}" style="margin-top: 10px;">
                {% csrf_token %}
                <input type="hidden" name="action" value="resend">
                <button type="submit" class="btn btn-secondary" style="width: 100%;">
                    <i class="fas fa-redo"></i>
                    Renvoyer le code
                </button>
            </form>
        </form>
        
        {% elif step == 'reset' %}
        <form method="POST" action="{% url 'utilisateurs:forgot_password' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="reset">
            
            <div class="form-group">
                <label class="form-label" for="password1">Nouveau mot de passe</label>
                <input type="password" id="password1" name="password1" class="form-input" placeholder="Créez un nouveau mot de passe" required>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="password2">Confirmer le mot de passe</label>
                <input type="password" id="password2" name="password2" class="form-input" placeholder="Confirmez votre mot de passe" required>
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-key"></i>
                Réinitialiser le mot de passe
            </button>
        </form>
        {% endif %}
        
        <div class="auth-footer">
            <p><a href="{% url 'utilisateurs:login' %}">Retour à la connexion</a></p>
        </div>
    </div>
</div>
{% endblock %}
